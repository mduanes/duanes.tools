#' @name pull_base
#' @export
#'
#'

# pull population base for given years

pull_base <- function(vintage=2024, # vintage of pop base
                      adg_path=Sys.getenv("ADG_KEY"), # adg path of user
                      years=seq(2010,year(Sys.Date()),1), # years to pull data for
                      age=FALSE, # break down by age?
                      race=FALSE, # break down by race?
                      sex=FALSE # break down by sex?
                      ) {

  # pull ADG key
  if(Sys.getenv("ADG_KEY") == "") {
    print("No ADG Path! Set using install_adg_key()")
  } else {

    # reference paths for various vintages
  refs <-c("2023"="results/2023/population_base_tidy_2023_rounded.csv",
           "2024"="results/2024/population_base_tidy_2024_updated.csv")
  # fetch based on vintage
  ref <- unname(refs[as.character(vintage)])
  # create full path
  full_path <- paste0(adg_path,"Projects/Active Projects/Georgia Population Projections/Population Base/",ref)

  # get grouping columns based on selections above
  chars <- c("COUNTY","YEAR")
  if (sex == TRUE) {
    chars <- c(chars,"SEX")
  }
  if(race == TRUE) {
    chars <- c(chars,"RACE_ETH")
  }
  if(age == TRUE) {
    chars <- c(chars,"AGE")
  }

  # read in base data and summarize by preferences
  readr::read_csv(full_path) %>%
    # group by selected variables and summarize
    dplyr::group_by(pick(chars)) %>%
    dplyr::summarize(POP=sum(POP)) %>%
    dplyr::ungroup() %>%
    # filter for only wanted years
    dplyr::filter(YEAR %in% years) %>%
    dplyr::mutate("VINTAGE"=vintage)
  }
}

