mutate(classified=case_when(field_class >= classes[i]~class_lab,
TRUE~classified))
}
}
data_out %>%
rename(field=field_class) %>%
mutate(classified=factor(classified,order))
}
df <- data.frame("field"=c(1,100,1000,10000000))
equal_interval(df,"field",5)
source("C:/Users/mds64585/OneDrive - University of Georgia/CVIOG/duanes.tools/R/equal_interval.R", echo=TRUE)
df <- data.frame("field"=c(1,100,1000,10000000))
equal_interval(df,"field",5)
source("C:/Users/mds64585/OneDrive - University of Georgia/CVIOG/duanes.tools/R/equal_interval.R", echo=TRUE)
equal_interval(df,"field",5)
source("C:/Users/mds64585/OneDrive - University of Georgia/CVIOG/duanes.tools/R/equal_interval.R", echo=TRUE)
equal_interval(df,"field",5)
source("C:/Users/mds64585/OneDrive - University of Georgia/CVIOG/duanes.tools/R/equal_interval.R", echo=TRUE)
equal_interval(df,"field",5)
source("C:/Users/mds64585/OneDrive - University of Georgia/CVIOG/duanes.tools/R/equal_interval.R", echo=TRUE)
source("C:/Users/mds64585/OneDrive - University of Georgia/CVIOG/duanes.tools/R/equal_interval.R", echo=TRUE)
equal_interval(df,"field",5)
source("C:/Users/mds64585/OneDrive - University of Georgia/CVIOG/duanes.tools/R/load_dependencies.R", echo=TRUE)
load_dependencies()
devtools::document()
manual_breaks <- function(data,field,breaks=c(), round=TRUE) {
field_fun <- data %>%
pull(field)
classes <- breaks
for(i in 1:n) {
if (i == 1) {
class_lab <- paste0(format(classes[i],big.mark=","), "-", format(classes[i+1]-1,big.mark=","))
order <- class_lab
data_out <- data %>%
rename("field_class"=sym(field)) %>%
mutate(classified=case_when(field_class >= classes[i] & field_class < classes[i+1]~class_lab,
TRUE~NA))
} else if (i != n) {
class_lab <- paste0(format(classes[i],big.mark=","), "-", format(classes[i+1]-1,big.mark=","))
order <- c(order,class_lab)
data_out <- data_out %>%
mutate(classified=case_when(field_class >= classes[i] & field_class < classes[i+1]~class_lab,
TRUE~classified))
} else {
class_lab <- paste0(format(classes[i],big.mark=","), "+")
order <- c(order,class_lab)
data_out <- data_out %>%
mutate(classified=case_when(field_class >= classes[i]~class_lab,
TRUE~classified))
}
}
data_out %>%
rename(field=field_class) %>%
mutate(classified=factor(classified,order))
}
df
manual_breaks(df,breaks=c(10,100,100))
manual_breaks(df,field,breaks=c(10,100,100))
rlang::last_trace()
manual_breaks(df,"field",breaks=c(10,100,100))
manual_breaks(df,"field",breaks=c(10,100,100))
manual_breaks(df,"field",breaks=c(10,100,100,1000))
manual_breaks(df,"field",breaks=c(10,100,100,1000,10000))
manual_breaks(df,"field",breaks=c(0,10,100,100,1000,10000))
get_fips <- function(ctys=c("Clarke","Russell,AL")) {
# pull state data to match fips
ADG_KEY <- get_adg_key()
state_fips <- foreign::read.dbf(paste0(ADG_KEY,"Data/TIGER files/tl_2024_us_state.dbf"))
# get states from provided counties
states <- data.frame(ctys) %>%
dplyr::mutate(state=ifelse(!stringr::str_detect(ctys,","),"GA",stringr::str_trunc(ctys,2,"left","")),
ctys=stringr::str_remove(ctys,",.*")) %>%
dplyr::left_join(state_fips,by=c("state"="STUSPS")) %>%
dplyr::select(ctys,STATEFP) %>%
mutate(cty=tolower(ctys))
# pull county data
fips <- foreign::read.dbf(paste0(ADG_KEY,"Data/TIGER files/US_county_2023.dbf")) %>%
dplyr:: select(STATEFP,COUNTYFP,NAME) %>%
mutate(NAMEjoin=tolower(NAME)) %>%
dplyr::right_join(states,by=c("STATEFP","NAMEjoin"="ctys")) %>%
dplyr::mutate("GEOID"=paste0(STATEFP,COUNTYFP)) %>%
pull(GEOID)
# return list of complete fips
fips
}
get_fips("Clarke")
source("C:/Users/mds64585/OneDrive - University of Georgia/CVIOG/duanes.tools/R/get_adg_key.R", echo=TRUE)
get_fips("Clarke")
# packages(openxlsx)  # for reading/writing files as Excel workbooks'
library(ggnewscale)
packages(tidyverse)
load_dependencies <- function() {
## Load or install packages
packages <- function(x) {
x <- deparse(substitute(x))
installed_packages <- as.character(installed.packages()[, 1])
if (length(intersect(x, installed_packages)) == 0) {
install.packages(pkgs = x, dependencies = TRUE, repos = "http://cran.r-project.org")
}
library(x, character.only = TRUE)
rm(installed_packages) # Remove From Workspace
}
# packages(openxlsx)  # for reading/writing files as Excel workbooks'
library(ggnewscale)
packages(tidyverse)
packages(tmap)
packages(tidycensus)
packages(tigris)
packages(sf)
packages(ggrepel)
packages(RColorBrewer)
packages(lubridate)
packages(knitr)
packages(fredr)
packages(BAMMtools)
packages(readxl)
#packages(flextable)
#packages(officedown)
#packages(officer)
packages(data.table)
}
load_dependencies
load_dependencies()
get_fips("Clarke")
# pull state data to match fips
ADG_KEY <- get_adg_key()
state_fips <- foreign::read.dbf(paste0(ADG_KEY,"Data/TIGER files/tl_2024_us_state.dbf"))
ctys <- "Clarke"
# get states from provided counties
states <- data.frame(ctys) %>%
dplyr::mutate(state=ifelse(!stringr::str_detect(ctys,","),"GA",stringr::str_trunc(ctys,2,"left","")),
ctys=stringr::str_remove(ctys,",.*")) %>%
dplyr::left_join(state_fips,by=c("state"="STUSPS")) %>%
dplyr::select(ctys,STATEFP) %>%
mutate(cty=tolower(ctys))
states
foreign::read.dbf(paste0(ADG_KEY,"Data/TIGER files/US_county_2023.dbf")) %>%
dplyr:: select(STATEFP,COUNTYFP,NAME)
foreign::read.dbf(paste0(ADG_KEY,"Data/TIGER files/US_county_2023.dbf")) %>%
dplyr:: select(STATEFP,COUNTYFP,NAME) %>%
mutate(NAMEjoin=tolower(NAME)) %>%
dplyr::right_join(states,by=c("STATEFP","NAMEjoin"="ctys"))
foreign::read.dbf(paste0(ADG_KEY,"Data/TIGER files/US_county_2023.dbf")) %>%
dplyr:: select(STATEFP,COUNTYFP,NAME) %>%
mutate(NAMEjoin=tolower(NAME))
# get states from provided counties
states <- data.frame(ctys) %>%
dplyr::mutate(state=ifelse(!stringr::str_detect(ctys,","),"GA",stringr::str_trunc(ctys,2,"left","")),
ctys=stringr::str_remove(ctys,",.*")) %>%
dplyr::left_join(state_fips,by=c("state"="STUSPS")) %>%
dplyr::select(ctys,STATEFP) %>%
mutate(ctys=tolower(ctys))
# pull county data
fips <- foreign::read.dbf(paste0(ADG_KEY,"Data/TIGER files/US_county_2023.dbf")) %>%
dplyr:: select(STATEFP,COUNTYFP,NAME) %>%
mutate(NAMEjoin=tolower(NAME)) %>%
dplyr::right_join(states,by=c("STATEFP","NAMEjoin"="ctys")) %>%
dplyr::mutate("GEOID"=paste0(STATEFP,COUNTYFP)) %>%
pull(GEOID)
get_fips <- function(ctys=c("Clarke","Russell,AL")) {
# pull state data to match fips
ADG_KEY <- get_adg_key()
state_fips <- foreign::read.dbf(paste0(ADG_KEY,"Data/TIGER files/tl_2024_us_state.dbf"))
# get states from provided counties
states <- data.frame(ctys) %>%
dplyr::mutate(state=ifelse(!stringr::str_detect(ctys,","),"GA",stringr::str_trunc(ctys,2,"left","")),
ctys=stringr::str_remove(ctys,",.*")) %>%
dplyr::left_join(state_fips,by=c("state"="STUSPS")) %>%
dplyr::select(ctys,STATEFP) %>%
mutate(ctys=tolower(ctys))
# pull county data
fips <- foreign::read.dbf(paste0(ADG_KEY,"Data/TIGER files/US_county_2023.dbf")) %>%
dplyr:: select(STATEFP,COUNTYFP,NAME) %>%
mutate(NAMEjoin=tolower(NAME)) %>%
dplyr::right_join(states,by=c("STATEFP","NAMEjoin"="ctys")) %>%
dplyr::mutate("GEOID"=paste0(STATEFP,COUNTYFP)) %>%
pull(GEOID)
# return list of complete fips
fips
}
get_fips("Clarke")
test <- "test"
testdf <- data.frame(test)
testdf
test_str <- "str"
rename(testdf,test,test_str)
dplyr::rename(testdf,test,test_str)
dplyr::rename(testdf,test_str=test)
test_str
nat_breaks <- function(data,field,n,forcezero=TRUE,round=TRUE) {
field_fun <- data %>%
pull(field)
classes <- BAMMtools::getJenksBreaks(field_fun,n)
if(round==TRUE) {
magnitude <- as.numeric(paste0(1,paste0(rep(0,(nchar(round(classes[2]))-1)),collapse="")))
classes <- plyr::round_any(classes,magnitude,floor)
}
if(forcezero==TRUE) {
for(i in 1:length(classes)) {
if(classes[i] < 0 & classes[i+1] >= 0) {
classes <- c(classes[1:i],0,classes[i+1:length(classes)])
}
}
}
for(i in 1:n) {
if (i == 1) {
class_lab <- paste0(format(classes[i],big.mark=","), "-", format(classes[i+1]-1,big.mark=","))
order <- class_lab
data_out <- data %>%
mutate("field_class"=sym(field)) %>%
mutate(classified=case_when(field_class >= classes[i] & field_class < classes[i+1]~class_lab,
TRUE~NA))
} else if (i != n) {
class_lab <- paste0(format(classes[i],big.mark=","), "-", format(classes[i+1]-1,big.mark=","))
order <- c(order,class_lab)
data_out <- data_out %>%
mutate(classified=case_when(field_class >= classes[i] & field_class < classes[i+1]~class_lab,
TRUE~classified))
} else {
class_lab <- paste0(format(classes[i],big.mark=","), "+")
order <- c(order,class_lab)
data_out <- data_out %>%
mutate(classified=case_when(field_class >= classes[i]~class_lab,
TRUE~classified))
}
}
data_out %>%
select(-field_class) %>%
mutate(classified=factor(classified,order))
}
test <- c(1,2,4,6,7,10,11,4)
test
test <- data.frame(test)
nat_breaks(test,5)
nat_breaks(test,'test',5)
loadedNamespaces()
source("C:/Users/mds64585/OneDrive - University of Georgia/CVIOG/duanes.tools/R/load_dependencies.R", echo=TRUE)
source("C:/Users/mds64585/OneDrive - University of Georgia/CVIOG/duanes.tools/R/nat_breaks.R", echo=TRUE)
nat_breaks(test,'test',5)
source("C:/Users/mds64585/OneDrive - University of Georgia/CVIOG/duanes.tools/R/nat_breaks.R", echo=TRUE)
nat_breaks(test,'test',5)
nat_breaks <- function(data,field,n,forcezero=TRUE,round=TRUE) {
field_fun <- data %>%
pull(field)
classes <- BAMMtools::getJenksBreaks(field_fun,n)
if(round==TRUE) {
magnitude <- as.numeric(paste0(1,paste0(rep(0,(nchar(round(classes[2]))-1)),collapse="")))
classes <- plyr::round_any(classes,magnitude,floor)
}
if(forcezero==TRUE) {
for(i in 1:length(classes)) {
if(classes[i] < 0 & classes[i+1] >= 0) {
classes <- c(classes[1:i],0,classes[i+1:length(classes)])
}
}
}
for(i in 1:n) {
if (i == 1) {
class_lab <- paste0(format(classes[i],big.mark=","), "-", format(classes[i+1]-1,big.mark=","))
order <- class_lab
data_out <- data %>%
rename("field_class"=sym(field)) %>%
mutate(classified=case_when(field_class >= classes[i] & field_class < classes[i+1]~class_lab,
TRUE~NA))
} else if (i != n) {
class_lab <- paste0(format(classes[i],big.mark=","), "-", format(classes[i+1]-1,big.mark=","))
order <- c(order,class_lab)
data_out <- data_out %>%
mutate(classified=case_when(field_class >= classes[i] & field_class < classes[i+1]~class_lab,
TRUE~classified))
} else {
class_lab <- paste0(format(classes[i],big.mark=","), "+")
order <- c(order,class_lab)
data_out <- data_out %>%
mutate(classified=case_when(field_class >= classes[i]~class_lab,
TRUE~classified))
}
}
data_out %>%
# select(-field_class) %>%
mutate(classified=factor(classified,order))
}
nat_breaks(test,'test',5)
colnames(test)
nat_breaks <- function(data,field,n,forcezero=TRUE,round=TRUE) {
field_fun <- data %>%
pull(field)
classes <- BAMMtools::getJenksBreaks(field_fun,n)
if(round==TRUE) {
magnitude <- as.numeric(paste0(1,paste0(rep(0,(nchar(round(classes[2]))-1)),collapse="")))
classes <- plyr::round_any(classes,magnitude,floor)
}
if(forcezero==TRUE) {
for(i in 1:length(classes)) {
if(classes[i] < 0 & classes[i+1] >= 0) {
classes <- c(classes[1:i],0,classes[i+1:length(classes)])
}
}
}
for(i in 1:n) {
if (i == 1) {
class_lab <- paste0(format(classes[i],big.mark=","), "-", format(classes[i+1]-1,big.mark=","))
order <- class_lab
data_out <- data %>%
rename("field_class"=sym(field)) %>%
mutate(classified=case_when(field_class >= classes[i] & field_class < classes[i+1]~class_lab,
TRUE~NA))
} else if (i != n) {
class_lab <- paste0(format(classes[i],big.mark=","), "-", format(classes[i+1]-1,big.mark=","))
order <- c(order,class_lab)
data_out <- data_out %>%
mutate(classified=case_when(field_class >= classes[i] & field_class < classes[i+1]~class_lab,
TRUE~classified))
} else {
class_lab <- paste0(format(classes[i],big.mark=","), "+")
order <- c(order,class_lab)
data_out <- data_out %>%
mutate(classified=case_when(field_class >= classes[i]~class_lab,
TRUE~classified))
}
}
data_out <- c(colnames(data),"classified")
data_out %>%
mutate(classified=factor(classified,order))
}
colnames(test)
nat_breaks(test,'test',5)
nat_breaks <- function(data,field,n,forcezero=TRUE,round=TRUE) {
field_fun <- data %>%
pull(field)
classes <- BAMMtools::getJenksBreaks(field_fun,n)
if(round==TRUE) {
magnitude <- as.numeric(paste0(1,paste0(rep(0,(nchar(round(classes[2]))-1)),collapse="")))
classes <- plyr::round_any(classes,magnitude,floor)
}
if(forcezero==TRUE) {
for(i in 1:length(classes)) {
if(classes[i] < 0 & classes[i+1] >= 0) {
classes <- c(classes[1:i],0,classes[i+1:length(classes)])
}
}
}
for(i in 1:n) {
if (i == 1) {
class_lab <- paste0(format(classes[i],big.mark=","), "-", format(classes[i+1]-1,big.mark=","))
order <- class_lab
data_out <- data %>%
rename("field_class"=sym(field)) %>%
mutate(classified=case_when(field_class >= classes[i] & field_class < classes[i+1]~class_lab,
TRUE~NA))
} else if (i != n) {
class_lab <- paste0(format(classes[i],big.mark=","), "-", format(classes[i+1]-1,big.mark=","))
order <- c(order,class_lab)
data_out <- data_out %>%
mutate(classified=case_when(field_class >= classes[i] & field_class < classes[i+1]~class_lab,
TRUE~classified))
} else {
class_lab <- paste0(format(classes[i],big.mark=","), "+")
order <- c(order,class_lab)
data_out <- data_out %>%
mutate(classified=case_when(field_class >= classes[i]~class_lab,
TRUE~classified))
}
}
data_out <- c(colnames(data),"classified")
#data_out %>%
#  mutate(classified=factor(classified,order))
}
nat_breaks(test,'test',5)
nat_breaks <- function(data,field,n,forcezero=TRUE,round=TRUE) {
field_fun <- data %>%
pull(field)
classes <- BAMMtools::getJenksBreaks(field_fun,n)
if(round==TRUE) {
magnitude <- as.numeric(paste0(1,paste0(rep(0,(nchar(round(classes[2]))-1)),collapse="")))
classes <- plyr::round_any(classes,magnitude,floor)
}
if(forcezero==TRUE) {
for(i in 1:length(classes)) {
if(classes[i] < 0 & classes[i+1] >= 0) {
classes <- c(classes[1:i],0,classes[i+1:length(classes)])
}
}
}
for(i in 1:n) {
if (i == 1) {
class_lab <- paste0(format(classes[i],big.mark=","), "-", format(classes[i+1]-1,big.mark=","))
order <- class_lab
data_out <- data %>%
rename("field_class"=sym(field)) %>%
mutate(classified=case_when(field_class >= classes[i] & field_class < classes[i+1]~class_lab,
TRUE~NA))
} else if (i != n) {
class_lab <- paste0(format(classes[i],big.mark=","), "-", format(classes[i+1]-1,big.mark=","))
order <- c(order,class_lab)
data_out <- data_out %>%
mutate(classified=case_when(field_class >= classes[i] & field_class < classes[i+1]~class_lab,
TRUE~classified))
} else {
class_lab <- paste0(format(classes[i],big.mark=","), "+")
order <- c(order,class_lab)
data_out <- data_out %>%
mutate(classified=case_when(field_class >= classes[i]~class_lab,
TRUE~classified))
}
}
data_out <- c(colnames(data),"classified")
#data_out %>%
#  mutate(classified=factor(classified,order))
data_out
}
nat_breaks(test,'test',5)
nat_breaks <- function(data,field,n,forcezero=TRUE,round=TRUE) {
field_fun <- data %>%
pull(field)
classes <- BAMMtools::getJenksBreaks(field_fun,n)
if(round==TRUE) {
magnitude <- as.numeric(paste0(1,paste0(rep(0,(nchar(round(classes[2]))-1)),collapse="")))
classes <- plyr::round_any(classes,magnitude,floor)
}
if(forcezero==TRUE) {
for(i in 1:length(classes)) {
if(classes[i] < 0 & classes[i+1] >= 0) {
classes <- c(classes[1:i],0,classes[i+1:length(classes)])
}
}
}
for(i in 1:n) {
if (i == 1) {
class_lab <- paste0(format(classes[i],big.mark=","), "-", format(classes[i+1]-1,big.mark=","))
order <- class_lab
data_out <- data %>%
rename("field_class"=sym(field)) %>%
mutate(classified=case_when(field_class >= classes[i] & field_class < classes[i+1]~class_lab,
TRUE~NA))
} else if (i != n) {
class_lab <- paste0(format(classes[i],big.mark=","), "-", format(classes[i+1]-1,big.mark=","))
order <- c(order,class_lab)
data_out <- data_out %>%
mutate(classified=case_when(field_class >= classes[i] & field_class < classes[i+1]~class_lab,
TRUE~classified))
} else {
class_lab <- paste0(format(classes[i],big.mark=","), "+")
order <- c(order,class_lab)
data_out <- data_out %>%
mutate(classified=case_when(field_class >= classes[i]~class_lab,
TRUE~classified))
}
}
colnames(data_out) <- c(colnames(data),"classified")
data_out %>%
mutate(classified=factor(classified,order))
}
nat_breaks(test,'test',5)
uga_colors <- function(n=1:8) {
c("#BA0C2F","#9EA2A2","#D6D2C4","#C8D8EB","#554F47","#E4002B","#00A3AD","#B4BD00","#004E60")[n]
}
uga_colors()
uga_colors(2)
uga_colors(3)
uga_colors(4)
pal_gen <- function(base_color=uga_colors(4),n_col=5) {
colorspace::sequential_hcl(n_col,
h = as(colorspace::hex2RGB(base_color), "polarLUV")@coords[3],
#c = as(hex2RGB(base_color), "polarLUV")@coords[2],
#l = as(hex2RGB(base_color), "polarLUV")@coords[1],
rev=TRUE)
}
pal_gen()
source("C:/Users/mds64585/OneDrive - University of Georgia/CVIOG/duanes.tools/R/pull_base.R", echo=TRUE)
pull_base()
library(tidyverse)
pull_base()
source("C:/Users/mds64585/OneDrive - University of Georgia/CVIOG/duanes.tools/R/pull_base.R", echo=TRUE)
pull_base()
pull_base(age=TRUE)
source("C:/Users/mds64585/OneDrive - University of Georgia/CVIOG/duanes.tools/R/pull_base.R", echo=TRUE)
pull_base(age=TRUE)
source("C:/Users/mds64585/OneDrive - University of Georgia/CVIOG/duanes.tools/R/pull_base.R", echo=TRUE)
pull_base(age=TRUE)
paste0(adg_path,"Projects/Active Projects/Georgia Population Projections/Population Base/results/2025/population_base_tidy_2025.csv")
read_csv(paste0(Sys.getenv("ADG_KEY"),"Projects/Active Projects/Georgia Population Projections/Population Base/results/2025/population_base_tidy_2025.csv"))
read_csv(paste0(Sys.getenv("ADG_KEY"),"Projects/Active Projects/Georgia Population Projections/Population Base/results/2025/population_base_2025.csv"))
library(tidycensus)
get_estimates(geography = "county",
state = 13)
get_estimates(geography = "county",
state = 13,
product = "components")
get_estimates(geography = "county",
state = 13,
product = "components",
year=2024)
get_estimates(geography = "county",
state = 13,
product = "characteristics",
year=2025)
get_estimates(geography = "county",
state = 13,
product = "characteristics",
year=2022)
get_estimates(geography = "county",
state = 13,
product = "characteristics",
year=2022) %>%
filter(AGEGROUP=1)
st <- 13
get_estimates(geography = "county",
state = st,
product = "characteristics",
year=2022) %>%
filter(AGEGROUP==1)
